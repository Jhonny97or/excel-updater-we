<script type="module">
  import { PublicClientApplication } from "https://cdn.jsdelivr.net/npm/@azure/msal-browser@2.39.0/+esm";

  // ─── ①  lee config que inyectamos desde /api/config.js ───
  const { clientId, authority } = window.EXCEL_UP_CFG;
  if (!clientId || !authority) {
    console.error("MSAL config missing!", window.EXCEL_UP_CFG);
    alert("Error interno: configuración MSAL ausente.");
    throw new Error("No MSAL config");
  }

  // ─── ②  instancia MSAL ───
  const msal = new PublicClientApplication({
    auth: { clientId, authority },
    cache: { cacheLocation: "localStorage" }   // opcional
  });

  // ─── ③  función de login interactivo ───
  async function signIn() {
    try {
      const resp = await msal.loginPopup({
        scopes: ["Files.Read.All", "User.Read"]
      });
      console.log("LOGIN OK", resp);
      document.getElementById("status").textContent =
        "✅ Sesión iniciada como " + resp.account.username;
      // Aquí podrías guardar el accessToken si vas a usar Graph.
    } catch (err) {
      console.error(err);
      alert("Error de login:\n" + err.message);
    }
  }

  // botón de login
  document.getElementById("btnLogin").onclick = signIn;
</script>

